# Kubernetes or K8s

- **오픈 소스** 프로젝트
- 가장 인기있는 **컨테이너 오케스트레이션 기술** 중 하나

## Container

- **완전히 격리된 가상 환경**
- **고유의 프로세스나 서비스**를 가질 수 있다
- **고유의 네트워킹 인터페이스 마운트**도 가질 수 있다.

## Container Orchestration

- **컨테이너를 자동으로 배포하고 관리**하는 프로세스를 의미한다.
- `쿠버네티스`는 **컨테이너 오케스트레이션 기술**이다.
- `쿠버네티스`는 사용자 지정 배포를 가능하게 해주고, 복잡한 아키텍처의 배포를 지원하는 **다양한 옵션을 지원**한다.
- `쿠버네티스`는 GCP, Azure, AWS와 같은 **모든 공용 클라우드 서비스 공급자에서 지원**된다.


**장점**

- **고가용성**
- **부하 분산**
- **오토 스케일링**

## Architecture

1. **Nodes**

`노드`는 쿠버네티스가 설치된 물리적인 가상 머신이다. `노드`는 **작업자 머신**으로 **컨테이너를 배포하는 곳**이다.

`노드`는 실행중인 애플리케이션이 실패할 가능성에 대비해서 **한 클러스터에 하나 이상**의 `노드`가 **필요**하다.

2. **Cluster**

`클러스터`는 **노드들의 집합**이다. `클러스터`에 여러 개의 노드들이 존재한다면 한 노드가 실패하더라도 다른 노드에서 앱에 접근할 수 있다.

또한 `클러스터` 안에 존재하는 여러 개의 노드는 부한 분산에도 유용하다.

3. **Master**

`마스터`는 쿠버네티스가 설치된 또 다른 노드이다. `마스터`는 클러스터에서 **노드들을 모니터링** 한다.

즉, 컨테이너의 **실제 오케스트레이션(관리 및 배포)을 책임**진다.

4. **Components**

시스템에 쿠버네티스를 설치할 때 같이 설치하는 요소이다. `API서버`와 기타 서비스, `kubelet`, `서비스 컨테이너`, `런타임 컨트롤러`, `스케줄러` 등이 존재한다.

`API Server`는 쿠버네티스의 프론트엔드처럼 작동한다. 사용자, 관리 장치 CLI 인터페이스 모두 **API 서버와 통신해 쿠버네티스 클러스터와 상호작용**한다.

`etcd`는 분산되고 신뢰할 수 있는 **키-값 저장소**로 쿠버네티스가 **클러스터 관리에 사용되는 모든 데이터를 저장하는데 사용**된다.

`scheduler`는 **다중 노드에 걸쳐 작업이나 컨테이너를 배포**한다. 새로 생성된 컨테이너를 찾아 노드에 할당한다.

`controller`는 **오케스트레이션을 제어**하는 두뇌이다. 노드, 컨테이너 엔드포인트가 **다운될 때 이를 인지하고 대응**한다. 이 경우 새 컨테이너를 들여올지 컨트롤러가 결정한다.

`container runtime`은 컨테이너를 실행하는 데 사용되는 기본 소프트웨어이다. **Docker** 등이 해당된다.

`kubelet`은 클러스터 내 각 노드에서 실행되는 에이전트이다. **예상대로 컨테이너가 노드에서 실행되는지 확인**한다.

## Master vs Worker Nodes

`Worker Node`는 **컨테이너가 호스팅되는 곳**이다. 시스템에서 Docker 컨테이너를 실행하려면 컨테이너 런타임이 설치돼야 한다. 우리의 경우에는 Docker가 해당한다. 굳이 Docker를 사용할 필요는 없다.

`Master`는 kube API 서버를 보유하고 있는데, 그 자체가 마스터가 된다. 비슷하게 Worker Node에도 kubelet 에이전트가 존재하는데, 마스터와 상호작용하는 에이전트로 노드의 Health 정보를 제공하고 Master가 요청한 작업을 수행한다.

수집된 모든 정보는 마스터의 etcd(key-value store)에 존재한다.

마스터는 또한 controller와 scheduler도 보유하고 있다.

## kubectl

kube 명령줄 도구 또는 kubectl, kube control이라고 한다.

kubectl은 쿠버네티스 클러스터 상의 응용 프로그램을 배포하고 관리하는데 사용된다.

클러스터 정보를 얻고 클러스터 내의 다른 노드의 상태를 얻는 등 수행한다.

- 클러스터에 **응용 프로그램을 배포**하는 명령어

```shell
kubectl run hello-minikube
```

- **클러스터 정보 조회** 명령어

```shell
kubectl cluster-info
```

- **모든 노드 조회** 명령어

```shell
kubectl get nodes
```